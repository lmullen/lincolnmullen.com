{
    "version": "https://jsonfeed.org/version/1.1",
    "title": "{{ .Site.Params.blogFeedTitle }}",
    "home_page_url": "{{ .Site.BaseURL }}",
    "feed_url": "{{ .Permalink }}",
    "description": "{{ .Site.Params.description }}",
    "icon": "data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸš€</text></svg>",
    "favicon": "data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸš€</text></svg>",
    "authors": [
        {
            "name": "{{ .Site.Params.author.name }}",
            "url": "{{ .Site.BaseURL }}"
        }
    ],
    "language": "en-US",
    "expired": false,
    "items": [
        {{- range $index, $element := first 50 (where .Site.RegularPages "Section" "in" (slice "blog" "micro" "newsletter")) }}
        {{- if $index }},{{ end }}
        {
            "id": "{{ $element.Permalink | absURL }}",
            "url": "{{ $element.Permalink | absURL }}",
            {{- if $element.Params.Linkpost }}
            "external_url": "{{ $element.Params.Linkpost }}",
            {{- else }}
            "title": {{ $element.Title | jsonify }},
            {{- end }}
            {{- $viaHTML := "" -}}
            {{- with $element.Params.via -}}
              {{- $viaHTML = printf "<p>Via: <a href=\"%s\">%s</a></p>" . ((urls.Parse .).Host) -}}
            {{- end }}
            "content_html": {{ printf "%s%s" $element.Content $viaHTML | jsonify }},
            "date_published": "{{ $element.Date.Format "2006-01-02T15:04:05Z07:00" }}"
            {{- /* banner_image: resolve from front matter or page bundle (no default fallback) */ -}}
            {{- $feedImage := "" -}}
            {{- if $element.Params.image -}}
              {{- $globalPath := strings.TrimPrefix "/" $element.Params.image -}}
              {{- with resources.Get $globalPath -}}
                {{- $feedImage = .Permalink -}}
              {{- else -}}
                {{- with $element.Resources.GetMatch $element.Params.image -}}
                  {{- $feedImage = .Permalink -}}
                {{- else -}}
                  {{- $feedImage = $element.Params.image | absURL -}}
                {{- end -}}
              {{- end -}}
            {{- else -}}
              {{- $conventionNames := slice "feature" "cover" "thumbnail" -}}
              {{- range $conventionNames -}}
                {{- if not $feedImage -}}
                  {{- with $element.Resources.GetMatch (printf "*%s*" .) -}}
                    {{- if ne .MediaType.SubType "svg" -}}
                      {{- $feedImage = .Permalink -}}
                    {{- end -}}
                  {{- end -}}
                {{- end -}}
              {{- end -}}
              {{- if not $feedImage -}}
                {{- range $element.Resources.ByType "image" -}}
                  {{- if and (not $feedImage) (ne .MediaType.SubType "svg") -}}
                    {{- $feedImage = .Permalink -}}
                  {{- end -}}
                {{- end -}}
              {{- end -}}
            {{- end -}}
            {{- if $feedImage }},
            "banner_image": {{ $feedImage | jsonify }}
            {{- end }}
            {{- if $element.Params.tags }},
            "tags": {{ $element.Params.tags | jsonify }}
            {{- end }},
            "authors": [
                {
                    "name": "{{ $element.Site.Params.author.name }}",
                    "url": "{{ $element.Site.BaseURL }}"
                }
            ]
        }
        {{- end }}
    ]
}
